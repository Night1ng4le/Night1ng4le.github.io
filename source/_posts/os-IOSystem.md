---
title: OS - I/O系统
categories: [CS Basis]
tags: [OS]
---

这个系列的文章都是学习清华《操作系统》（向勇、陈渝老师）的时候自己做的课程笔记。
视频来源：学堂在线
本章笔记主要是I/O系统相关知识，更为详细的内容推荐阅读课本

### I/O特点
#### 设备接口类型及特征
- 字符设备 
	- 存取速度慢，如：键盘鼠标串口
	- 特征：以字节为单位顺序访问
	- I/O命令：get(),put() 

<!-- more -->

- 块设备 
	- 存储设备，如：磁盘驱动器、磁带驱动器、光驱
	- 特征：以均匀数据块为单位
	- I/O命令：文件接口、原始I/O接口（以便提速）、内存映射文件访问
- 网络设备 
	- 计算机和外界沟通的设备，如：以太网、无线、蓝牙等
	- 特征：格式化的报文交换
	- I/O命令：send/receive报文、接口下支持多种网络协议

#### 同步和异步I/O
- 阻塞I/O - wait，读写一定成功
- 非阻塞I/O - don't wait，读写不一定成功
- 异步I/O - tell me later，二者结合

### I/O结构
北桥 - 高速设备
南桥 - I/O设备

#### CPU与设备的连接
- 设备控制器
	- CPU和I/O设备间的接口
	- 向CPU提供特殊指令和寄存器（数据交互/状态交互）
- I/O地址
	- CPU用来控制I/O硬件
	- 内存地址或端口号
		- I/O指令
		- 内存映射I/O
- CPU与设备的通信方式
	- 轮询、设备中断、DMA

#### I/O指令和内存映射I/O
- I/O指令
	- 通过I/O端口号访问设备寄存器（即通过端口号来区分所访问的设备及相应功能）
	- 特殊的CPU指令 - out/in
- 内存映射I/O
	- 设备寄存器/存储被映射到内存物理地址空间中
	- 相应指令 - load/store
	- MMU设置映射，或硬件跳线，或程序启动时地址


### I/O数据传输
#### CPU与设备控制器的数据传输
- 程序直接控制I/O（PIO）
	- 通过in/out或者load/store传输所有数据
	- 特点
		- 硬件简单，编程容易
		- 消耗CPU时间和数据量成正比
	- 适用于简单的、小型的设备I/O
- 直接内存访问（DMA）
	- 设备控制器可直接访问系统总线
	- 控制器直接与内存互相传输数据
	- 特点
		- 基本单位是控制块
		- 所传送的数据是设备直接到内存，或相反
		- 设备传输数据不影响CPU
		- 需要CPU参与设置，仅在一个或多个数据块开始或结束的时候
	- 适用于高吞吐量的设备I/O
- 中断驱动访问

#### I/O设备通知OS的机制
- OS需要了解设备状态
	- I/O操作完成的时间
	- I/O操作中遇到的错误
- 两种方式
	- CPU主动轮询
		- I/O设备在特定的`状态寄存器`中放置状态和错误信息
		- OS`定期检测`状态寄存器
		- 特点：
			- 简单
			- I/O操作频繁或不可预测时，开销大（操作频繁）和延时长（不知道什么时候发生状态改变）
	- 设备中断
		- 中断处理流程
			- CPU在I/O之前设置任务参数
			- CPU发出I/O请求后，继续执行其他任务
			- I/O设备处理I/O请求
			- I/O设备处理完成时，触发CPU中断请求
			- CPU接收中断，分发到相应中断处理例程
		- 特点
			- 处理不可预测时间效果好
			- 开销相对较高
- 实际中会结合设备中断和CPU轮询

### 磁盘调度
- FCFS
- SSTF（最短寻道时间优先）
- SCAN
	- CSCAN（循环扫描，单向移动）
	- FSCAN（NStepSCAN的优化，两个子列）
	- NStepSCAN（n个子列）

### 磁盘缓存
- 磁盘冗余阵列
	-raid0







